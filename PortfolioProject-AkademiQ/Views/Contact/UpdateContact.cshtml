@model PortfolioProject_AkademiQ.Entities.Contact
@{
    ViewData["Title"] = "İletişim Bilgilerini Güncelle";
    Layout = "~/Views/Admin/Index.cshtml";
}

<main class="flex-1 flex flex-col h-full overflow-hidden relative bg-background-dark">
    <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-accent-blue/5 rounded-full blur-[120px] pointer-events-none"></div>

    <header class="flex items-center justify-between px-8 py-6 z-10 border-b border-white/5 bg-background-dark/80 backdrop-blur-md">
        <div>
            <h2 class="text-2xl font-bold text-white tracking-tight">İletişim Ayarları</h2>
            <p class="text-text-muted text-sm mt-1">Site üzerindeki iletişim bilgilerinizi ve harita konumunuzu düzenleyin.</p>
        </div>

        <button type="submit" form="contactForm" class="hidden md:flex items-center gap-2 px-6 py-2 rounded-full bg-gradient-accent hover:opacity-90 text-white font-bold text-sm transition-all shadow-lg shadow-accent-purple/20 active:scale-95">
            <span class="material-symbols-outlined text-[18px]">save</span>
            Değişiklikleri Kaydet
        </button>
    </header>

    <div class="flex-1 overflow-y-auto p-8 scroll-smooth relative z-0">
        <div class="max-w-7xl mx-auto">

            <form id="contactForm" method="post" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <input type="hidden" asp-for="ContactId" />

                <div class="space-y-6">

                    <div class="bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg relative overflow-hidden group">
                        <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-accent-purple to-transparent opacity-50"></div>

                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-outlined text-accent-purple">connect_without_contact</span>
                            İletişim Kanalları
                        </h3>

                        <div class="space-y-6">
                            <div class="group/input">
                                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">E-Posta Adresi</label>
                                <div class="relative">
                                    <span class="material-symbols-outlined absolute left-4 top-3.5 text-gray-500 group-focus-within/input:text-white transition-colors">mail</span>
                                    <input type="text" asp-for="Email" class="w-full bg-background-darker border border-white/10 text-white text-sm rounded-xl block pl-12 p-3.5 focus:border-accent-purple focus:ring-1 focus:ring-accent-purple outline-none transition-all placeholder:text-gray-600" placeholder="mail@example.com">
                                </div>
                            </div>

                            <div class="group/input">
                                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Telefon Numarası</label>
                                <div class="relative">
                                    <span class="material-symbols-outlined absolute left-4 top-3.5 text-gray-500 group-focus-within/input:text-white transition-colors">call</span>
                                    <input type="text" asp-for="Phone" class="w-full bg-background-darker border border-white/10 text-white text-sm rounded-xl block pl-12 p-3.5 focus:border-accent-purple focus:ring-1 focus:ring-accent-purple outline-none transition-all placeholder:text-gray-600" placeholder="+90 555 ...">
                                </div>
                            </div>

                            <div class="group/input">
                                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Web Sitesi</label>
                                <div class="relative">
                                    <span class="material-symbols-outlined absolute left-4 top-3.5 text-gray-500 group-focus-within/input:text-white transition-colors">language</span>
                                    <input type="text" asp-for="WebSite" class="w-full bg-background-darker border border-white/10 text-white text-sm rounded-xl block pl-12 p-3.5 focus:border-accent-purple focus:ring-1 focus:ring-accent-purple outline-none transition-all placeholder:text-gray-600" placeholder="www.mysite.com">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg relative overflow-hidden group">
                        <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-accent-blue to-transparent opacity-50"></div>

                        <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <span class="material-symbols-outlined text-accent-blue">pin_drop</span>
                            Konum Bilgileri
                        </h3>

                        <div class="space-y-6">
                            <div class="group/input">
                                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Açık Adres</label>
                                <div class="relative">
                                    <span class="material-symbols-outlined absolute left-4 top-3.5 text-gray-500 group-focus-within/input:text-white transition-colors">location_on</span>
                                    <textarea asp-for="Address" rows="3" class="w-full bg-background-darker border border-white/10 text-white text-sm rounded-xl block pl-12 p-3.5 focus:border-accent-blue focus:ring-1 focus:ring-accent-blue outline-none transition-all placeholder:text-gray-600 resize-none" placeholder="Mahalle, Cadde, Sokak..."></textarea>
                                </div>
                            </div>

                            <div class="group/input">
                                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 ml-1">Google Maps Embed URL (Src)</label>
                                <div class="relative">
                                    <span class="material-symbols-outlined absolute left-4 top-3.5 text-gray-500 group-focus-within/input:text-white transition-colors">map</span>
                                    <textarea asp-for="MapLocation" id="mapInput" rows="4" class="w-full bg-background-darker border border-white/10 text-white text-sm rounded-xl block pl-12 p-3.5 focus:border-accent-blue focus:ring-1 focus:ring-accent-blue outline-none transition-all placeholder:text-gray-600 resize-none font-mono text-xs" placeholder='Google Maps > Paylaş > Harita Yerleştir > HTML Kopyala'></textarea>
                                </div>
                                <p class="text-[10px] text-gray-500 mt-2 pl-1">
                                    * Harita önizlemesi yanda otomatik olarak görünecektir.
                                </p>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="space-y-6">
                    <div class="bg-card-dark rounded-2xl border border-white/5 p-6 shadow-lg sticky top-6">
                        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span class="material-symbols-outlined text-green-400">explore</span>
                            Canlı Harita Önizleme
                        </h3>

                        <div class="w-full h-[450px] rounded-xl overflow-hidden bg-background-darker border-2 border-dashed border-white/10 relative group">

                            <iframe id="mapPreview"
                                    src="@Model.MapLocation"
                                    class="w-full h-full object-cover grayscale-[20%] hover:grayscale-0 transition-all duration-500"
                                    frameborder="0"
                                    style="border:0; width: 100%; height: 100%;"
                                    allowfullscreen=""
                                    loading="lazy"
                                    referrerpolicy="no-referrer-when-downgrade">
                            </iframe>

                            <div id="mapPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-gray-600 bg-[#16181d] z-10 @(!string.IsNullOrEmpty(Model.MapLocation) ? "hidden" : "")">
                                <span class="material-symbols-outlined text-5xl mb-2 opacity-50">wrong_location</span>
                                <span class="text-sm font-medium">Harita önizlemesi için link giriniz.</span>
                            </div>
                        </div>

                        <button type="submit" class="w-full md:hidden mt-6 flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-accent hover:opacity-90 text-white font-bold text-sm transition-all shadow-lg active:scale-95">
                            <span class="material-symbols-outlined">save</span>
                            Kaydet
                        </button>
                    </div>
                </div>

            </form>
        </div>
    </div>
</main>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const value = '@TempData["Update"]';
        if (value) {
            Swal.fire({
                title: value,
                icon: 'success',
                confirmButtonText: 'Tamam',
                background: '#151022',
                color: '#ffffff',
                confirmButtonColor: '#5b2bee'
            });
        }
    });
</script>
<script>
    const mapInput = document.getElementById('mapInput');
    const mapPreview = document.getElementById('mapPreview');
    const mapPlaceholder = document.getElementById('mapPlaceholder');

    // Link ayrıştırma ve önizleme fonksiyonu
    function updateMap(val) {
        val = val.trim();

        // Kullanıcı <iframe> kodu yapıştırdıysa içinden src="" kısmını al
        if (val.includes('<iframe') && val.includes('src="')) {
            const srcMatch = val.match(/src="([^"]*)"/);
            if (srcMatch && srcMatch[1]) {
                val = srcMatch[1];
            }
        }

        if(val && val.includes('http')) {
            mapPreview.src = val;
            mapPlaceholder.classList.add('hidden');
        } else {
            mapPreview.src = '';
            mapPlaceholder.classList.remove('hidden');
        }
    }

    // Input değiştiğinde tetikle
    mapInput.addEventListener('input', function(e) {
        updateMap(e.target.value);
    });

    // Sayfa ilk açıldığında mevcut veri varsa işle (iframe temizliği için)
    window.addEventListener('DOMContentLoaded', () => {
        updateMap(mapInput.value);
    });
</script>